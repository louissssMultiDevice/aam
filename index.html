<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Handi Dev • Device Insight (Advanced)</title>
  <meta name="theme-color" content="#071018" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    :root{--bg:#071018;--card:#0f1720;--text:#dff8f6;--muted:#9fbfc8;--accent:#00ffc6;--accent-2:#00c2ff;--glass:rgba(255,255,255,0.03);--radius:14px}
    [data-theme='light']{--bg:#f6fbff;--card:#fff;--text:#032027;--muted:#4b6b74;--glass:rgba(0,0,0,0.03)}
    *{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#071018);color:var(--text)}
    .wrap{max-width:1100px;margin:24px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#001}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:10px;align-items:center}
    .btn{background:linear-gradient(90deg,var(--accent-2),var(--accent));border:none;padding:8px 12px;border-radius:10px;color:#001;font-weight:700;cursor:pointer}
    .toggle{background:var(--card);border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:12px;cursor:pointer}
    .badges{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:18px}
    .badge{background:linear-gradient(180deg,var(--glass),transparent);padding:12px;border-radius:12px;border:1px solid rgba(0,255,198,0.06)}
    .k{font-size:12px;color:var(--muted)}.v{font-weight:800;font-size:16px;margin-top:6px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .small{font-size:12px;color:var(--muted);margin-top:8px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,monospace}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .footer{margin:22px 0;color:var(--muted);font-size:13px}
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:9999;backdrop-filter:blur(4px);visibility:hidden;opacity:0;transition:all .18s}
    .overlay.show{visibility:visible;opacity:1}
    .loader{background:var(--card);padding:18px;border-radius:12px;display:flex;gap:12px;align-items:center}
    @media (max-width:520px){header{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <div class="brand">
        <div class="logo">HD</div>
        <div>
          <h1>Handi Dev • Device Insight (Advanced)</h1>
          <div class="subtitle">Versi canggih: sensor, incognito check, benchmark, PWA & export</div>
        </div>
      </div>
      <div class="controls">
        <button class="toggle btn" id="themeBtn">Theme</button>
        <button class="toggle btn" id="copyAll">Copy</button>
        <button class="toggle btn" id="exportJSON">JSON</button>
        <button class="toggle btn" id="exportCSV">CSV</button>
        <button class="toggle btn" id="exportXLSX">XLSX</button>
      </div>
    </header><div class="badges">
  <div class="badge"><div class="k">Today</div><div class="v" id="today">—</div></div>
  <div class="badge"><div class="k">Local</div><div class="v" id="clock-local">--:--:--</div></div>
  <div class="badge"><div class="k">WIB</div><div class="v" id="clock-wib">--:--:--</div></div>
  <div class="badge"><div class="k">TimeZone</div><div class="v" id="region">—</div></div>
</div>

<div class="grid">
  <div class="card">
    <h3>Device</h3>
    <div class="v" id="device">—</div>
    <div class="small mono" id="ua">—</div>
  </div>

  <div class="card">
    <h3>Battery & Power</h3>
    <div class="v" id="battery-level">—</div>
    <div class="small" id="battery-status">—</div>
  </div>

  <div class="card">
    <h3>Network & IP</h3>
    <div class="v mono" id="ip">—</div>
    <div class="small">Status: <span id="online">—</span> • Downlink: <span id="downlink">—</span> Mbps</div>
    <div class="row" style="margin-top:8px"><button class="btn" id="btn-ip">Refresh IP</button><button class="btn" id="pingBtn">Ping</button><button class="btn" id="speedBtn">Speed</button></div>
    <div class="small" id="netRes">—</div>
  </div>

  <div class="card">
    <h3>Performance</h3>
    <div class="v" id="sys">—</div>
    <div class="small">Cores: <span id="cores">—</span> • RAM: <span id="ram">—</span> GB • JS Heap: <span id="heap">—</span></div>
    <div style="margin-top:8px" class="row"><button class="btn" id="benchBtn">Run Benchmark</button><div id="benchRes" class="small">—</div></div>
  </div>

  <div class="card">
    <h3>Sensors</h3>
    <div class="v" id="sensorVal">—</div>
    <div class="small">Accelerometer / Orientation jika tersedia</div>
  </div>

  <div class="card">
    <h3>Security</h3>
    <div class="v" id="incognito">—</div>
    <div class="small" id="secureNotes">Cookies/localStorage & proxy check</div>
  </div>

  <div class="card">
    <h3>Viewport & FPS</h3>
    <div class="v" id="vp">—</div>
    <div class="small">DPR: <span id="dpr">—</span> • FPS: <span id="fps">—</span></div>
  </div>

  <div class="card">
    <h3>AI Insight</h3>
    <div class="v" id="aiInsight">—</div>
    <div class="small">Rekomendasi otomatis berdasarkan data</div>
  </div>

</div>

<div class="footer">Beberapa fitur memerlukan izin (lokasi/sensor/clipboard). Untuk XLSX aku pakai SheetJS via CDN (opsional). PWA & service worker included (register saja di server).</div>

  </div>  <div class="overlay" id="overlay"><div class="loader"><div class="dot"></div><div><div id="overlayTxt">Loading…</div><div class="small">Mohon tunggu</div></div></div></div>  <script>
    // small helpers
    const $ = id => document.getElementById(id);
    function pad(n){return String(n).padStart(2,'0')}
    function fmtDate(d){const days=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];const months=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];return `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`}

    // clocks
    function tick(){const now=new Date();$('today').textContent=fmtDate(now);$('clock-local').textContent=`${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;const wib=new Date(now.toLocaleString('en-US',{timeZone:'Asia/Jakarta'}));$('clock-wib').textContent=`${pad(wib.getHours())}:${pad(wib.getMinutes())}:${pad(wib.getSeconds())}`}
    setInterval(tick,1000);tick();

    // timezone
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';$('region').textContent = tz;

    // theme persistence + auto
    const root=document.documentElement;const themeBtn=$('themeBtn');
    function applyTheme(t){root.setAttribute('data-theme',t);localStorage.setItem('handi_theme',t)}
    (function(){const saved=localStorage.getItem('handi_theme');if(saved){applyTheme(saved);}else{const prefers = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;applyTheme(prefers? 'light':'dark')}})();
    themeBtn.addEventListener('click',()=>applyTheme(root.getAttribute('data-theme')==='light'?'dark':'light'));

    // basic fill
    $('ua').textContent = navigator.userAgent;
    function parseDevice(ua){const isAndroid=/Android/i.test(ua);const isIOS=/iPhone|iPad|iPod/i.test(ua);const isWin=/Windows/i.test(ua);const isMac=/Macintosh/i.test(ua);const isLinux=/Linux/i.test(ua)&&!isAndroid;const os=isAndroid?'Android':isIOS?'iOS':isWin?'Windows':isMac?'macOS':isLinux?'Linux':'Unknown';const br= (/Chrome\//.test(ua)&&!/Edg\//.test(ua))? 'Chrome' : /Edg\//.test(ua)? 'Edge' : /Firefox\//.test(ua)? 'Firefox' : /Safari\//.test(ua)? 'Safari' : 'Browser lain';return `${os} • ${br}`} 
    $('device').textContent=parseDevice(navigator.userAgent);

    // battery advanced
    async function setupBattery(){try{if(!('getBattery' in navigator)) throw new Error('Tidak didukung');const b=await navigator.getBattery();const paint=()=>{$('battery-level').textContent=Math.round(b.level*100)+'%';$('battery-status').textContent=b.charging? 'Charging' : 'Discharging • ' + (b.chargingTime? 'CT:'+b.chargingTime+'s':'');};['levelchange','chargingchange'].forEach(e=>b.addEventListener(e,paint));paint();}catch(e){$('battery-level').textContent='—';$('battery-status').textContent=e.message}}setupBattery();

    // network & ip
    async function fetchIP(){try{$('overlay').classList.add('show');$('overlayTxt').textContent='Mengambil IP...';const r=await fetch('https://api.ipify.org?format=json');const j=await r.json();$('ip').textContent=j.ip || '—';}catch(e){$('ip').textContent='Gagal ambil IP'}finally{$('overlay').classList.remove('show')}}
    $('btn-ip').addEventListener('click',fetchIP);fetchIP();

    // navigator.connection paint
    function paintNet(){const c=navigator.connection||navigator.mozConnection||navigator.webkitConnection;$('online').textContent = navigator.onLine? 'online':'offline';$('downlink').textContent = c?.downlink ?? '—';}
    paintNet();(navigator.connection||{}).addEventListener?.('change',paintNet);window.addEventListener('online',paintNet);window.addEventListener('offline',paintNet);

    // storage + heap
    $('cores').textContent = navigator.hardwareConcurrency || '—';$('ram').textContent = navigator.deviceMemory || '—';
    async function paintMemory(){try{if(performance?.memory){$('heap').textContent = (performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+' MB';}else{$('heap').textContent='N/A'}}catch(e){$('heap').textContent='—'}}
    setInterval(paintMemory,1500);paintMemory();

    // viewport & fps
    function paintVP(){ $('vp').textContent = `${window.innerWidth} × ${window.innerHeight}`; $('dpr').textContent = window.devicePixelRatio || 1 }
    paintVP();window.addEventListener('resize',paintVP);
    let frames=0,last=performance.now();function loop(now){frames++; if(now-last>=1000){$('fps').textContent = frames+' fps'; frames=0; last=now;} requestAnimationFrame(loop);}requestAnimationFrame(loop);

    // sensors: deviceorientation & accelerometer (if available)
    let accelSupport=false; if('DeviceMotionEvent' in window){window.addEventListener('devicemotion',e=>{accelSupport=true;const a=e.accelerationIncludingGravity; if(a) $('sensorVal').textContent = `Acc X:${(a.x||0).toFixed(2)} Y:${(a.y||0).toFixed(2)} Z:${(a.z||0).toFixed(2)}`});}
    if('DeviceOrientationEvent' in window){window.addEventListener('deviceorientation',e=>{$('sensorVal').textContent = `α:${(e.alpha||0).toFixed(1)} β:${(e.beta||0).toFixed(1)} γ:${(e.gamma||0).toFixed(1)}`});}

    // incognito detection (best-effort)
    (async function incognitoCheck(){try{let fs = window.RequestFileSystem || window.webkitRequestFileSystem; if(!fs){ // fallback timing test
        const key = 'handi_test'; try{localStorage.setItem(key,'1'); localStorage.removeItem(key); $('incognito').textContent='Normal (localStorage OK)'; return;}catch(err){$('incognito').textContent='Private/Restricted (localStorage failure)'; return;}
      }
      fs(window.TEMPORARY,100,()=>{$('incognito').textContent='Normal'},()=>{$('incognito').textContent='Incognito/Private'})
    }catch(e){$('incognito').textContent='Tidak pasti'} })();

    // basic proxy/vpn guess via ip -> country mismatch with tz (heuristic)
    async function proxyGuess(){try{const r=await fetch('https://ipapi.co/json/');const j=await r.json();const ip=j.ip;const country=j.country;const tz_ip=j.timezone;const tz_local = Intl.DateTimeFormat().resolvedOptions().timeZone; if(tz_ip && tz_local && tz_ip.split('/')[0] !== tz_local.split('/')[0]){$('secureNotes').textContent = `Kemungkinan VPN/Proxy (TZ mismatch: ${tz_ip} ≠ ${tz_local})`}else{$('secureNotes').textContent = `IP Country: ${country} • TZ: ${tz_ip || '—'}`};}catch(e){$('secureNotes').textContent='Tidak bisa cek proxy (API)'}}
    proxyGuess();

    // benchmark - small synthetic test
    $('benchBtn').addEventListener('click',async ()=>{
      $('benchRes').textContent='Running...';
      await new Promise(r=>setTimeout(r,50));
      const t0=performance.now(); let s=0; for(let i=0;i<4e7;i++){ s += (i%7==0? i : i*0.000001); if(i%1e7===0) await 0; }
      const dur=(performance.now()-t0)/1000; $('benchRes').textContent = `Done: ${dur.toFixed(2)}s`;
      aiAnalysis();
    });

    // ping: measure RTT to an endpoint via fetch + timing (works cross-origin if server allows)
    $('pingBtn').addEventListener('click',async ()=>{
      $('netRes').textContent='Pinging...'; const url='https://cloudflare-ipfs.com/ipfs/QmPChd2hVbrJ6Y3vD1W2b3b7V1qz2b1'; try{const t0=performance.now(); await fetch(url,{cache:'no-store',mode:'no-cors'}); const rtt = (performance.now()-t0).toFixed(1); $('netRes').textContent = `RTT ~ ${rtt} ms`;}catch(e){$('netRes').textContent='Ping raw failed (CORS); using timing approximation'; const t0=performance.now(); try{await fetch('https://api.ipify.org?format=json');$('netRes').textContent = `RTT ~ ${(performance.now()-t0).toFixed(1)} ms`}catch{ $('netRes').textContent='Gagal ping'} }
    });

    // speed: multiple downloads (small/medium) with time measurement
    $('speedBtn').addEventListener('click',async ()=>{
      $('overlay').classList.add('show');$('overlayTxt').textContent='Speed test...';$('netRes').textContent='—';
      const urls=['https://eu.httpbin.org/stream-bytes/200000?seed=0','https://eu.httpbin.org/stream-bytes/1000000?seed=1'];
      try{let out=''; for(const u of urls){const t0=performance.now(); const r=await fetch(u); const reader=r.body.getReader(); let rec=0; while(true){const {done,value}=await reader.read(); if(done) break; rec += value.length} const dur=(performance.now()-t0)/1000; const kb=rec/1024; out += `${(kb/dur).toFixed(0)} KB/s (${(kb/1024/dur).toFixed(2)} MB/s) \n`;}
        $('netRes').textContent = out;
      }catch(e){$('netRes').textContent='Gagal speed test (CORS/Blocked)'}finally{$('overlay').classList.remove('show')}
    });

    // AI Insight - simple heuristics based on collected data
    function aiAnalysis(){
      const cores = navigator.hardwareConcurrency||2; const ram = navigator.deviceMemory||2; const heap = (performance?.memory?.usedJSHeapSize||0)/1024/1024; let notes=[];
      if(ram<2) notes.push('RAM terbatas — multitasking berat kurang ideal'); else if(ram>=8) notes.push('RAM cukup untuk multitasking & sebagian game');
      if(cores<=2) notes.push('CPU rendah — rekomendasi: jangan buka banyak tab berat'); else notes.push('CPU baik untuk tugas umum');
      if(heap>200) notes.push('Heap JS tinggi — mungkin ada aplikasi berat di background');
      $('aiInsight').textContent = notes.join(' • ') || 'Normal';
    }
    aiAnalysis();

    // Export helpers
    function collectAll(){return {
      timestamp:new Date().toISOString(), device:$('device').textContent, ua:navigator.userAgent, timezone:tz, battery:$('battery-level').textContent,
      battery_status:$('battery-status').textContent, ip:$('ip').textContent, online:$('online').textContent, downlink:$('downlink').textContent,
      cores:$('cores').textContent, ram:$('ram').textContent, heap:$('heap').textContent, vp:$('vp').textContent, dpr:$('dpr').textContent, fps:$('fps').textContent,
      ai:$('aiInsight').textContent, incognito:$('incognito').textContent
    }}

    $('copyAll').addEventListener('click',async ()=>{try{await navigator.clipboard.writeText(JSON.stringify(collectAll(),null,2));alert('Disalin ke clipboard')}catch{alert('Gagal salin')}});

    $('exportJSON').addEventListener('click',()=>{const j=JSON.stringify(collectAll(),null,2);const blob=new Blob([j],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`handidev-${Date.now()}.json`;a.click();URL.revokeObjectURL(url)});

    $('exportCSV').addEventListener('click',()=>{const obj=collectAll();const keys=Object.keys(obj);const csv = keys.join(',') + '\n' + keys.map(k=>`"${String(obj[k]).replace(/"/g,'""')}"`).join(',');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`handidev-${Date.now()}.csv`;a.click();URL.revokeObjectURL(url)});

    // XLSX using SheetJS (optional). Will inject script from CDN at runtime. If offline, button will alert.
    $('exportXLSX').addEventListener('click',async ()=>{
      if(typeof XLSX === 'undefined'){
        // try load CDN
        $('overlay').classList.add('show');$('overlayTxt').textContent='Mengunduh library xlsx...';
        try{await new Promise((res,rej)=>{const s=document.createElement('script');s.src='https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js';s.onload=res;s.onerror=rej;document.head.appendChild(s)}); }catch(e){$('overlay').classList.remove('show');return alert('Tidak bisa load SheetJS. Gunakan CSV/JSON atau sambungkan internet.')} finally{$('overlay').classList.remove('show')}
      }
      try{const obj=collectAll(); const ws=XLSX.utils.json_to_sheet([obj]); const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'Report'); const wbout=XLSX.write(wb,{bookType:'xlsx',type:'array'}); const blob=new Blob([wbout],{type:'application/octet-stream'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`handidev-${Date.now()}.xlsx`; a.click(); URL.revokeObjectURL(url);}catch(e){alert('Export XLSX gagal')}
    });

    // register service worker (PWA offline cache) - basic
    if('serviceWorker' in navigator){navigator.serviceWorker.register('/sw.js').then(()=>console.log('SW registered')).catch(()=>console.log('SW fail'))}

    // initial ai + periodic
    setInterval(aiAnalysis,10000);

  </script></body>
</html>
