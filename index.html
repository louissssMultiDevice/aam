<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Handi Dev • Device Insight — Ultimate</title>
  <meta name="theme-color" content="#071018" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    :root{--bg:#071018;--card:#0f1720;--text:#dff8f6;--muted:#9fbfc8;--accent:#00ffc6;--accent-2:#00c2ff;--glass:rgba(255,255,255,0.03);--radius:14px}
    [data-theme='light']{--bg:#f6fbff;--card:#fff;--text:#032027;--muted:#4b6b74;--glass:rgba(0,0,0,0.03)}
    *{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#071018);color:var(--text)}
    .wrap{max-width:1250px;margin:18px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#001}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{background:linear-gradient(90deg,var(--accent-2),var(--accent));border:none;padding:8px 12px;border-radius:10px;color:#001;font-weight:700;cursor:pointer}
    .toggle{background:var(--card);border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:12px;cursor:pointer}
    .badges{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:18px}
    .badge{background:linear-gradient(180deg,var(--glass),transparent);padding:12px;border-radius:12px;border:1px solid rgba(0,255,198,0.06)}
    .k{font-size:12px;color:var(--muted)}.v{font-weight:800;font-size:16px;margin-top:6px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;margin-top:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .small{font-size:12px;color:var(--muted);margin-top:8px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,monospace}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .footer{margin:22px 0;color:var(--muted);font-size:13px}
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:9999;backdrop-filter:blur(4px);visibility:hidden;opacity:0;transition:all .18s}
    .overlay.show{visibility:visible;opacity:1}
    .loader{background:var(--card);padding:18px;border-radius:12px;display:flex;gap:12px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);animation:blink 1s infinite}
    @keyframes blink{50%{opacity:0.25;transform:scale(.8)}}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:920px){.cols{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <div class="brand">
        <div class="logo">HD</div>
        <div>
          <h1>Handi Dev • Device Insight — Ultimate</h1>
          <div class="subtitle">Semua info: device, network, media, sensor, security, export & insights</div>
        </div>
      </div>
      <div class="controls">
        <button class="toggle btn" id="themeBtn">Theme</button>
        <button class="toggle btn" id="copyAll">Copy</button>
        <button class="toggle btn" id="exportJSON">JSON</button>
        <button class="toggle btn" id="exportCSV">CSV</button>
        <button class="toggle btn" id="exportXLSX">XLSX</button>
      </div>
    </header><div class="badges">
  <div class="badge"><div class="k">Today</div><div class="v" id="today">—</div></div>
  <div class="badge"><div class="k">Local</div><div class="v" id="clock-local">--:--:--</div></div>
  <div class="badge"><div class="k">WIB</div><div class="v" id="clock-wib">--:--:--</div></div>
  <div class="badge"><div class="k">TimeZone</div><div class="v" id="region">—</div></div>
</div>

<div class="grid">
  <!-- Basic info -->
  <div class="card">
    <h3>Device & Browser</h3>
    <div class="v" id="device">—</div>
    <div class="small mono" id="ua">—</div>
    <div class="small" id="browserEngine">Engine: —</div>
    <div class="small" id="browserVersion">Version: —</div>
    <div class="small" id="osVersion">OS detail: —</div>
  </div>

  <div class="card">
    <h3>Battery & Power</h3>
    <div class="v" id="battery-level">—</div>
    <div class="small" id="battery-status">—</div>
  </div>

  <div class="card">
    <h3>Network & IP</h3>
    <div class="v mono" id="ip">—</div>
    <div class="small">Status: <span id="online">—</span> • Downlink: <span id="downlink">—</span> Mbps</div>
    <div class="row" style="margin-top:8px"><button class="btn" id="btn-ip">Refresh IP</button><button class="btn" id="pingBtn">Ping</button><button class="btn" id="speedBtn">Speed</button></div>
    <div class="small" id="netRes">—</div>
  </div>

  <div class="card">
    <h3>Performance</h3>
    <div class="v" id="sys">—</div>
    <div class="small">Cores: <span id="cores">—</span> • RAM: <span id="ram">—</span> GB • JS Heap: <span id="heap">—</span></div>
    <div style="margin-top:8px" class="row"><button class="btn" id="benchBtn">Run Benchmark</button><div id="benchRes" class="small">—</div></div>
  </div>

  <!-- Sensors -->
  <div class="card">
    <h3>Sensors</h3>
    <div class="v" id="sensorVal">—</div>
    <div class="small">Accelerometer / Orientation jika tersedia</div>
  </div>

  <!-- Security -->
  <div class="card">
    <h3>Security</h3>
    <div class="v" id="incognito">—</div>
    <div class="small" id="secureNotes">Cookies/localStorage & proxy check</div>
  </div>

  <!-- Viewport -->
  <div class="card">
    <h3>Viewport & FPS</h3>
    <div class="v" id="vp">—</div>
    <div class="small">DPR: <span id="dpr">—</span> • FPS: <span id="fps">—</span></div>
  </div>

  <!-- AI -->
  <div class="card">
    <h3>AI Insight</h3>
    <div class="v" id="aiInsight">—</div>
    <div class="small">Rekomendasi otomatis berdasarkan data</div>
  </div>

  <!-- New detection features -->
  <div class="card">
    <h3>GPU & WebGL</h3>
    <div class="v" id="gpu">—</div>
    <div class="small" id="webglInfo">WebGL: —</div>
  </div>

  <div class="card">
    <h3>Languages & Locale</h3>
    <div class="v" id="lang">—</div>
    <div class="small">All: <span id="langs">—</span></div>
  </div>

  <div class="card">
    <h3>Cookies & Privacy</h3>
    <div class="v" id="cookies">—</div>
    <div class="small">Do Not Track: <span id="dnt">—</span></div>
  </div>

  <div class="card">
    <h3>Storage & Quota</h3>
    <div class="v" id="storage">—</div>
    <div class="small">Quota: <span id="quota">—</span> • Used: <span id="usage">—</span></div>
  </div>

  <div class="card">
    <h3>Permissions</h3>
    <div class="v" id="permClipboard">Clipboard: —</div>
    <div class="small">Camera: <span id="permCamera">—</span> • Microphone: <span id="permMic">—</span></div>
  </div>

  <div class="card">
    <h3>Screen & Touch</h3>
    <div class="v" id="screen">—</div>
    <div class="small">Color depth: <span id="colorDepth">—</span> • Touch points: <span id="touch">—</span></div>
  </div>

  <div class="card">
    <h3>Geolocation</h3>
    <div class="v mono" id="geo">—</div>
    <div class="row" style="margin-top:8px"><button class="btn" id="btn-geo">Get Location</button></div>
    <div class="small">Izin lokasi diperlukan untuk akurasi.</div>
  </div>

  <div class="card">
    <h3>Vibrate / Idle / SW</h3>
    <div class="v" id="vibrate">—</div>
    <div class="small">IdleDetector: <span id="idle">—</span> • ServiceWorker: <span id="swstatus">—</span></div>
  </div>

  <div class="card">
    <h3>Referrer & Media</h3>
    <div class="v" id="referrer">—</div>
    <div class="small">Camera devices: <span id="mediaDevices">—</span></div>
  </div>

  <div class="card cols">
    <div>
      <h3>Export / Save</h3>
      <div class="row" style="margin-top:8px"><button class="btn" id="exportJSONBtn">Export JSON</button><button class="btn" id="exportCSVBtn">CSV</button><button class="btn" id="exportXLSXBtn">XLSX</button></div>
    </div>
    <div>
      <h3>Utilities</h3>
      <div class="row" style="margin-top:8px"><button class="btn" id="qrBtn">QR</button><button class="btn" id="notifyBtn">Push</button><button class="btn" id="clipboardTest">Clipboard Test</button></div>
    </div>
  </div>

</div>

<div class="footer">Beberapa fitur memerlukan izin (lokasi/sensor/clipboard). XLSX memakai SheetJS CDN. PWA & service worker bisa diaktifkan pada server.</div>

  </div>  <div class="overlay" id="overlay"><div class="loader"><div class="dot"></div><div><div id="overlayTxt">Loading…</div><div class="small">Mohon tunggu</div></div></div></div>  <script>
    // helpers
    const $ = id => document.getElementById(id);
    function pad(n){return String(n).padStart(2,'0')}
    function fmtDate(d){const days=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];const months=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];return `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`}

    // clocks
    function tick(){const now=new Date();$('today').textContent=fmtDate(now);$('clock-local').textContent=`${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;const wib=new Date(now.toLocaleString('en-US',{timeZone:'Asia/Jakarta'}));$('clock-wib').textContent=`${pad(wib.getHours())}:${pad(wib.getMinutes())}:${pad(wib.getSeconds())}`}
    setInterval(tick,1000);tick();

    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';$('region').textContent = tz;

    // theme persistence + auto
    const root=document.documentElement;const themeBtn=$('themeBtn');
    function applyTheme(t){root.setAttribute('data-theme',t);localStorage.setItem('handi_theme',t)}
    (function(){const saved=localStorage.getItem('handi_theme');if(saved){applyTheme(saved);}else{const prefers = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;applyTheme(prefers? 'light':'dark')}})();
    themeBtn.addEventListener('click',()=>applyTheme(root.getAttribute('data-theme')==='light'?'dark':'light'));

    // UA, device, browser
    $('ua').textContent = navigator.userAgent;
    function parseDevice(ua){const isAndroid=/Android/i.test(ua);const isIOS=/iPhone|iPad|iPod/i.test(ua);const isWin=/Windows/i.test(ua);const isMac=/Macintosh/i.test(ua);const isLinux=/Linux/i.test(ua)&&!isAndroid;const os=isAndroid?'Android':isIOS?'iOS':isWin?'Windows':isMac?'macOS':isLinux?'Linux':'Unknown';let br='Browser lain'; if(/Chrome\//.test(ua)&&!/Edg\//.test(ua)) br='Chrome'; if(/Edg\//.test(ua)) br='Edge'; if(/Firefox\//.test(ua)) br='Firefox'; if(/Safari\//.test(ua)&&!/Chrome\//.test(ua)) br='Safari'; const brVer = (ua.match(/(Chrome|Firefox|Edg|Safari)\/([0-9\.]+)/)||[])[2]||'—'; return {os,br,brVer}}
    const dv = parseDevice(navigator.userAgent); $('device').textContent = `${dv.os} • ${dv.br}`; $('browserEngine').textContent = `Engine: ${navigator.product || '—'}`; $('browserVersion').textContent = `Version: ${dv.brVer}`; $('osVersion').textContent = navigator.platform || '—';

    // battery
    async function setupBattery(){try{if(!('getBattery' in navigator)) throw new Error('Tidak didukung');const b=await navigator.getBattery();const paint=()=>{$('battery-level').textContent=Math.round(b.level*100)+'%';$('battery-status').textContent=b.charging? 'Charging' : 'Discharging • ' + (b.chargingTime? 'CT:'+b.chargingTime+'s':'');};['levelchange','chargingchange'].forEach(e=>b.addEventListener(e,paint));paint();}catch(e){$('battery-level').textContent='—';$('battery-status').textContent=e.message}}setupBattery();

    // network & ip
    async function fetchIP(){try{$('overlay').classList.add('show');$('overlayTxt').textContent='Mengambil IP...';const r=await fetch('https://api.ipify.org?format=json');const j=await r.json();$('ip').textContent=j.ip || '—';}catch(e){$('ip').textContent='Gagal ambil IP'}finally{$('overlay').classList.remove('show')}}
    $('btn-ip').addEventListener('click',fetchIP);fetchIP();

    function paintNet(){const c=navigator.connection||navigator.mozConnection||navigator.webkitConnection;$('online').textContent = navigator.onLine? 'online':'offline';$('downlink').textContent = c?.downlink ?? '—';}
    paintNet();(navigator.connection||{}).addEventListener?.('change',paintNet);window.addEventListener('online',paintNet);window.addEventListener('offline',paintNet);

    // storage estimate
    async function paintStorage(){try{const est = await navigator.storage.estimate(); const used=est.usage||0, quota=est.quota||0; $('storage').textContent = `${fmtBytes(used)} / ${fmtBytes(quota)} (${Math.round(quota?used/quota*100:0)}%)`; $('quota').textContent = fmtBytes(quota); $('usage').textContent = fmtBytes(used);}catch(e){$('storage').textContent='—';$('quota').textContent='—';$('usage').textContent='—'}}
    function fmtBytes(n){if(!n && n!==0) return '—';const units=['B','KB','MB','GB','TB'];let i=0;let v=n;while(v>1024 && i<units.length-1){v/=1024;i++}return `${v.toFixed(1)} ${units[i]}`}
    paintStorage();

    // storage / heap & cores
    $('cores').textContent = navigator.hardwareConcurrency || '—';$('ram').textContent = navigator.deviceMemory || '—';
    async function paintMemory(){try{if(performance?.memory){$('heap').textContent = (performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+' MB';}else{$('heap').textContent='N/A'}}catch(e){$('heap').textContent='—'}}
    setInterval(paintMemory,1500);paintMemory();

    // viewport & fps
    function paintVP(){ $('vp').textContent = `${window.innerWidth} × ${window.innerHeight}`; $('dpr').textContent = window.devicePixelRatio || 1 }
    paintVP();window.addEventListener('resize',paintVP);
    let frames=0,last=performance.now();function loop(now){frames++; if(now-last>=1000){$('fps').textContent = frames+' fps'; frames=0; last=now;} requestAnimationFrame(loop);}requestAnimationFrame(loop);

    // sensors
    if('DeviceMotionEvent' in window){window.addEventListener('devicemotion',e=>{const a=e.accelerationIncludingGravity; if(a) $('sensorVal').textContent = `Acc X:${(a.x||0).toFixed(2)} Y:${(a.y||0).toFixed(2)} Z:${(a.z||0).toFixed(2)}`;});}
    if('DeviceOrientationEvent' in window){window.addEventListener('deviceorientation',e=>{$('sensorVal').textContent = `α:${(e.alpha||0).toFixed(1)} β:${(e.beta||0).toFixed(1)} γ:${(e.gamma||0).toFixed(1)}`;});}

    // languages
    $('lang').textContent = navigator.language || '—'; $('langs').textContent = (navigator.languages||[]).join(', ');

    // cookies & DNT
    $('cookies').textContent = navigator.cookieEnabled? 'Enabled':'Disabled'; $('dnt').textContent = navigator.doNotTrack || navigator.msDoNotTrack || '—';

    // permissions: clipboard, camera, mic
    async function checkPermissions(){ try{ const cb = await navigator.permissions.query({name:'clipboard-read'}).catch(()=>null); const cbw = await navigator.permissions.query({name:'clipboard-write'}).catch(()=>null); $('permClipboard').textContent = (cb?.state||cbw?.state||'unknown'); }catch(e){$('permClipboard').textContent='—'}
      try{ const cam = await navigator.permissions.query({name:'camera'}).catch(()=>null); const mic = await navigator.permissions.query({name:'microphone'}).catch(()=>null); $('permCamera').textContent = cam?.state||'unknown'; $('permMic').textContent = mic?.state||'unknown'; }catch(e){$('permCamera').textContent='—';$('permMic').textContent='—'} }
    checkPermissions();

    // screen info & touch
    $('screen').textContent = `${screen.width}×${screen.height}`; $('colorDepth').textContent = screen.colorDepth || '—'; $('touch').textContent = navigator.maxTouchPoints || 0;

    // geolocation
    $('btn-geo').addEventListener('click', ()=>{
      if(!('geolocation' in navigator)) return $('geo').textContent = 'Geolocation tidak didukung'; $('overlay').classList.add('show');$('overlayTxt').textContent='Mengambil koordinat...';
      navigator.geolocation.getCurrentPosition(pos=>{ const {latitude,longitude}=pos.coords; $('geo').textContent = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`; $('overlay').classList.remove('show'); }, err=>{ $('geo').textContent = err.message; $('overlay').classList.remove('show'); }, {enableHighAccuracy:true,timeout:10000});
    });

    // vibrate support
    $('vibrate').textContent = (typeof navigator.vibrate === 'function')? 'Supported' : 'Not supported';

    // IdleDetector check
    (async ()=>{ if('IdleDetector' in window){$('idle').textContent='Supported'}else{$('idle').textContent='Not supported'}})();

    // service worker status
    if('serviceWorker' in navigator){ navigator.serviceWorker.getRegistration().then(reg=>{$('swstatus').textContent = reg? 'Registered':'Not registered';}).catch(()=>{$('swstatus').textContent='Error'});}else{$('swstatus').textContent='No SW'}

    // referrer
    $('referrer').textContent = document.referrer || '—';

    // media devices list
    async function listMedia(){ try{ const devices = await navigator.mediaDevices.enumerateDevices(); const cams = devices.filter(d=>d.kind==='videoinput'); $('mediaDevices').textContent = cams.length + ' cameras'; return devices;}catch(e){$('mediaDevices').textContent='Gagal';return []}}
    listMedia();

    // camera permission quick-check by querying permissions (may be 'prompt')
    async function detectCameraPermission(){ try{ const p = await navigator.permissions.query({name:'camera'}).catch(()=>null); $('permCamera').textContent = p?.state || '—'; }catch(e){$('permCamera').textContent='—'} }
    detectCameraPermission();

    // fingerprint (improved)
    function getWebGLInfo(){ try{ const c = document.createElement('canvas'); const gl = c.getContext('webgl') || c.getContext('experimental-webgl'); if(!gl) return null; const dbg = gl.getExtension('WEBGL_debug_renderer_info'); const vendor = dbg ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR); const renderer = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER); return {vendor,renderer}; }catch(e){return null} }
    async function sha256(s){ const buf = new TextEncoder().encode(s); const h = await crypto.subtle.digest('SHA-256',buf); return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
    async function makeFingerprint(){ const webgl = JSON.stringify(getWebGLInfo()||{}); const base = navigator.userAgent + '|' + navigator.language + '|' + webgl + '|' + (navigator.hardwareConcurrency||'') + '|' + (navigator.deviceMemory||'') + '|' + screen.width + 'x' + screen.height; const h = await sha256(base); $('fingerprint').textContent = h.slice(0,22); }
    makeFingerprint();

    // adblock detection
    (function detectAdblock(){ const bait = document.createElement('div'); bait.className = 'adsbox'; bait.style.height='1px'; bait.style.position='absolute'; bait.style.left='-10000px'; document.body.appendChild(bait); window.setTimeout(()=>{ try{ if(getComputedStyle(bait).display==='none' || bait.offsetParent===null){ $('adblock').textContent='AdBlock terdeteksi'}else{$('adblock').textContent='No AdBlock'} }catch(e){$('adblock').textContent='—'} bait.remove(); },120); })();

    // incognito check (best-effort)
    (async function incognitoCheck(){ try{ let fs = window.RequestFileSystem || window.webkitRequestFileSystem; if(!fs){ try{ localStorage.setItem('handi_test','1'); localStorage.removeItem('handi_test'); $('incognito').textContent='Normal (localStorage OK)'; return;}catch(err){$('incognito').textContent='Private/Restricted (localStorage failure)'; return;} }
      fs(window.TEMPORARY,100,()=>{$('incognito').textContent='Normal'},()=>{$('incognito').textContent='Incognito/Private'})
    }catch(e){$('incognito').textContent='Tidak pasti'} })();

    // benchmark - CPU (web worker)
    $('benchBtn').addEventListener('click',()=>{ $('benchRes').textContent='Running...'; const blob = new Blob([`onmessage=function(){const t0=Date.now();let c=0; for(let i=0;i<4e7;i++){ c += (i&1); } postMessage(Date.now()-t0);}`],{type:'text/javascript'}); const w = new Worker(URL.createObjectURL(blob)); w.onmessage = e=>{ $('benchRes').textContent = e.data + ' ms (worker)'; w.terminate(); }; w.postMessage('start'); });

    // ping & speed (simple)
    $('pingBtn').addEventListener('click',async ()=>{ $('netRes').textContent='Pinging...'; const url='https://api.ipify.org?format=json'; try{ const t0=performance.now(); await fetch(url,{cache:'no-store'}); $('netRes').textContent = `RTT ${(performance.now()-t0).toFixed(1)} ms`; }catch(e){$('netRes').textContent='Ping gagal'} });
    $('speedBtn').addEventListener('click',async ()=>{ $('overlay').classList.add('show');$('overlayTxt').textContent='Speed test...'; try{ const u='https://eu.httpbin.org/stream-bytes/500000?seed=0'; const t0=performance.now(); const r=await fetch(u); const reader = r.body.getReader(); let rec=0; while(true){ const {done,value} = await reader.read(); if(done) break; rec += value.length } const dur=(performance.now()-t0)/1000; const kb=rec/1024; $('netRes').textContent = `${(kb/dur).toFixed(0)} KB/s • ${(kb/1024/dur).toFixed(2)} MB/s`; }catch(e){$('netRes').textContent='Gagal (CORS/Blocked)'} finally{$('overlay').classList.remove('show')} });

    // export helpers
    function collectAll(){ return {
      timestamp:new Date().toISOString(), device: $('device').textContent, ua:navigator.userAgent, gpu: $('gpu').textContent, ip: $('ip').textContent,
      online: $('online').textContent, downlink: $('downlink').textContent, cores: $('cores').textContent, ram: $('ram').textContent, heap: $('heap').textContent,
      storage: $('storage').textContent, fingerprint: $('fingerprint').textContent, ai: $('aiInsight').textContent, incognito: $('incognito').textContent
    }}

    document.getElementById('copyAll').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(JSON.stringify(collectAll(),null,2)); alert('Disalin ke clipboard'); }catch(e){ alert('Gagal salin: '+e.message) }});

    document.getElementById('exportJSONBtn').addEventListener('click', ()=>{ const j=JSON.stringify(collectAll(),null,2); const blob=new Blob([j],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='handidev-ultimate.json'; a.click(); });
    document.getElementById('exportCSVBtn').addEventListener('click', ()=>{ const obj=collectAll(); const keys=Object.keys(obj); const csv = keys.join(',') + '
' + keys.map(k=>`"${String(obj[k]).replace(/"/g,'""')}"`).join(','); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='handidev-ultimate.csv'; a.click(); });
    document.getElementById('exportXLSXBtn').addEventListener('click', async ()=>{ if(typeof XLSX === 'undefined'){ try{ $('overlay').classList.add('show');$('overlayTxt').textContent='Mengunduh SheetJS...'; await new Promise((res,rej)=>{ const s=document.createElement('script'); s.src='https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js'; s.onload=res; s.onerror=rej; document.head.appendChild(s); }); }catch(e){ $('overlay').classList.remove('show'); return alert('Gagal load SheetJS'); } finally{ $('overlay').classList.remove('show'); } }
      try{ const obj = collectAll(); const ws = XLSX.utils.json_to_sheet([obj]); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'Report'); const wbout = XLSX.write(wb,{bookType:'xlsx',type:'array'}); const blob = new Blob([wbout],{type:'application/octet-stream'}); const a=document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'handidev-ultimate.xlsx'; a.click(); }catch(e){ alert('Export XLSX gagal: '+e.message) } });

    // QR generator
    document.getElementById('qrBtn').addEventListener('click', async ()=>{ if(typeof QRCode === 'undefined'){ await new Promise((res,rej)=>{ const s=document.createElement('script'); s.src='https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js'; s.onload=res; s.onerror=rej; document.head.appendChild(s); }); } const data = JSON.stringify(collectAll()); const w = window.open('about:blank'); w.document.write('<div id="q"></div><pre>'+data+'</pre>'); new w.QRCode(w.document.getElementById('q'),{text:data,width:240,height:240}); });// notifications
document.getElementById('notifyBtn').addEventListener('click', async ()=>{ if(!('Notification' in window)) return alert('Notifikasi tidak didukung'); const p = await Notification.requestPermission(); if(p==='granted'){ new Notification('Handi Dev','Notifikasi diizinkan'); } else alert('Izin notifikasi: '+p); });

// clipboard live test
document.getElementById('clipboardTest').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText('HandiDev Clipboard Test'); const text = await navigator.clipboard.readText(); alert('Clipboard read: '+text); }catch(e){ alert('Clipboard test gagal: '+e.message) } });

// service worker register hook
if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw.js').then(()=>console.log('SW registered')).catch(()=>console.log('SW failed')); }

// AI insight heuristics
function aiAnalysis(){ const cores=navigator.hardwareConcurrency||2; const ram=navigator.deviceMemory||2; const heap=(performance?.memory?.usedJSHeapSize||0)/1024/1024; const notes=[]; if(ram<2) notes.push('RAM terbatas'); else if(ram>=8) notes.push('RAM besar: multitasking OK'); if(cores<=2) notes.push('CPU sedikit'); else notes.push('CPU cukup'); if(heap>300) notes.push('Heap JS tinggi'); $('aiInsight').textContent = notes.join(' • ') || 'Normal'; }
aiAnalysis(); setInterval(aiAnalysis,10000);

// init
(async function init(){ try{ await listMedia(); fetchIP(); getLocalIPs(); paintStorage(); checkPermissions(); makeFingerprint(); }catch(e){console.error(e);} })();

// WebRTC local IPs (best-effort)
async function getLocalIPs(){ const ips=new Set(); try{ const pc = new RTCPeerConnection({iceServers:[]}); pc.createDataChannel(''); pc.onicecandidate = e=>{ if(!e.candidate) return; const s=e.candidate.candidate; const m = s.match(/([0-9]{1,3}(?:\.[0-9]{1,3}){3})/g); if(m) m.forEach(ip=>ips.add(ip)); $('localIPs').textContent = Array.from(ips).join(', '); }; const offer = await pc.createOffer(); await pc.setLocalDescription(offer); setTimeout(()=>pc.close(),2000);}catch(e){$('localIPs').textContent='Tidak tersedia'} }

// make fingerprint convenience wrapper
async function makeFingerprint(){ const webgl=getWebGLInfo(); const base = navigator.userAgent + '|' + navigator.language + '|' + JSON.stringify(webgl) + '|' + (navigator.hardwareConcurrency||'') + '|' + (navigator.deviceMemory||'') + '|' + screen.width + 'x' + screen.height; const hash = await sha256(base); $('fingerprint').textContent = hash.slice(0,22); }

  </script>
</body>
</html>
