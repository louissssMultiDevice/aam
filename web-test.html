<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Warung Pedia — Digital Marketplace</title>
  <style>
    /* Simple modern styles */
    :root{--accent:#ff6b6b;--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:linear-gradient(180deg,#071025 0%, #07182a 100%);color:#e6eef6}
    header{padding:20px 28px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#ff9a9a);display:flex;align-items:center;justify-content:center;font-weight:700}
    nav{display:flex;gap:10px;align-items:center}
    button, .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer}
    main{padding:24px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    h2{margin:0 0 8px 0}
    .small{color:var(--muted);font-size:13px}
    .price{font-weight:700;margin-top:8px}
    footer{padding:20px 28px;color:var(--muted)}
    .menu-list{display:flex;gap:8px;flex-wrap:wrap}
    .menu-col{min-width:220px}
    .contact{display:flex;flex-direction:column;gap:6px}
    .actions{display:flex;gap:8px}
    /* modal */
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;padding:20px}
    .overlay.open{display:flex}
    .modal{background:#071428;padding:20px;border-radius:12px;max-width:520px;width:100%;border:1px solid rgba(255,255,255,0.04)}
    .qr-img{width:100%;height:auto;border-radius:8px}
    .muted{color:var(--muted)}
    .tag{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.04);font-size:12px}
    .show-more{cursor:pointer;color:var(--accent);text-decoration:underline}
    @media (max-width:640px){header{flex-direction:column;align-items:flex-start;gap:12px}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">WP</div>
      <div>
        <div style="font-size:18px;font-weight:700">Warung Pedia</div>
        <div class="small">Digital marketplace — nokos, panel, vps, jasa</div>
      </div>
    </div>
    <nav>
      <button id="contactBtn" class="btn">Contact Us</button>
      <button id="cartBtn" class="btn">Keranjang</button>
    </nav>
  </header>  <main>
    <section style="margin-bottom:20px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Menu Nomer</h2>
        <div class="small">nokos all region</div>
      </div>
      <div class="grid" style="margin-top:12px">
        <!-- Example nomor product card -->
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:700">NOKOS • All Region</div>
              <div class="muted small">Stok auto-delivery</div>
            </div>
            <div class="tag">Rp5.000</div>
          </div>
          <div class="actions" style="margin-top:12px">
            <button class="btn buyBtn" data-sku="nokos_all_01" data-title="NOKOS All Region" data-price="5000">Beli</button>
            <button class="btn" onclick="showQuick('info')">Detail</button>
          </div>
        </div>
      </div>
    </section><section style="margin-bottom:20px">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>Pterodactyl Panel</h2>
    <div class="small">Panel Bot — pilih ukuran</div>
  </div>
  <div class="grid" style="margin-top:12px">
    <!-- List panels 1-10gb + Unlimited -->
    <script>
      const panels = ['1GB','2GB','3GB','4GB','5GB','6GB','7GB','8GB','9GB','10GB','Unlimited'];
      panels.forEach(p => document.write(`
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><div style="font-weight:700">Panel Bot ${p}</div><div class="muted small">Pterodactyl Panel</div></div>
            <div class="tag">Rp${(p==='Unlimited')? '200.000' : (parseInt(p)||0)*25000}</div>
          </div>
          <div class="actions" style="margin-top:12px">
            <button class="btn buyBtn" data-sku="panel_${p}" data-title="Panel Bot ${p}" data-price="${(p==='Unlimited')?200000:(parseInt(p)||0)*25000}">Beli</button>
            <span class="show-more" onclick="toggleList(this)">Show More</span>
          </div>
        </div>
      `));
    </script>
  </div>
</section>

<section style="margin-bottom:20px">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>VPS</h2>
    <div class="small">Pilih paket VPS</div>
  </div>
  <div class="grid" style="margin-top:12px">
    <div class="card"><div style="font-weight:700">8GB C4</div><div class="muted small">Rp150.000/bulan</div><div class="actions" style="margin-top:12px"><button class="btn buyBtn" data-sku="vps_8_c4" data-title="VPS 8GB C4" data-price="150000">Beli</button></div></div>
    <div class="card"><div style="font-weight:700">8GB C8</div><div class="muted small">Rp200.000/bulan</div><div class="actions" style="margin-top:12px"><button class="btn buyBtn" data-sku="vps_8_c8" data-title="VPS 8GB C8" data-price="200000">Beli</button></div></div>
    <div class="card"><div style="font-weight:700">16GB C6</div><div class="muted small">Rp300.000/bulan</div><div class="actions" style="margin-top:12px"><button class="btn buyBtn" data-sku="vps_16_c6" data-title="VPS 16GB C6" data-price="300000">Beli</button></div></div>
    <div class="card"><div style="font-weight:700">16GB C8</div><div class="muted small">Rp350.000/bulan</div><div class="actions" style="margin-top:12px"><button class="btn buyBtn" data-sku="vps_16_c8" data-title="VPS 16GB C8" data-price="350000">Beli</button></div></div>
  </div>
</section>

<section style="margin-bottom:20px">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>Jasa Hanami</h2>
    <div class="small">Jasa pembuatan web & bot</div>
  </div>
  <div class="grid" style="margin-top:12px">
    <div class="card"><div style="font-weight:700">Jasa Bikin Website</div><div class="muted small">Mulai Rp150.000</div><div class="actions" style="margin-top:12px"><button class="btn buyBtn" data-sku="jasa_web" data-title="Jasa Bikin Website" data-price="150000">Order</button></div></div>
    <div class="card"><div style="font-weight:700">Jasa Bikin Script Bot WhatsApp</div><div class="muted small">Mulai Rp100.000</div><div class="actions" style="margin-top:12px"><button class="btn buyBtn" data-sku="jasa_bot" data-title="Jasa Bikin Script Bot WhatsApp" data-price="100000">Order</button></div></div>
  </div>
</section>

  </main>  <footer>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div class="contact">
        <div style="font-weight:700">Contact Us</div>
        <div class="small">WhatsApp: <a href="https://wa.me/6285800650661" target="_blank" style="color:var(--accent)">+62 858-0065-0661</a></div>
        <div class="small">Email: -</div>
      </div>
      <div class="small">© Warung Pedia • Auto-delivery & QRIS (Payku) ready</div>
    </div>
  </footer>  <!-- modal overlay for QRIS -->  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div id="modalTitle" style="font-weight:700">Checkout</div>
        <button onclick="closeModal()" class="btn">Close</button>
      </div>
      <div id="modalBody" style="margin-top:12px">
        <div class="muted small">Menunggu transaksi...</div>
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button class="btn" onclick="cancelCurrent()">Cancel</button>
      </div>
    </div>
  </div>  <script>
    // Minimal client-side flow: frontend calls your backend endpoints which must implement Payku interaction
    // --- CONFIG ---
    const API_BASE = '/api'; // sesuaikan dengan alamat backend (misal https://api.fikastore.id)

    let currentTransaction = null;

    function toggleList(el){
      alert('Fungsi "Show More" bisa dihubungkan ke detail panel / halaman produk.');
    }

    function showQuick(section){
      alert('Quick info: fitur akan dikembangkan sesuai request.');
    }

    document.querySelectorAll('.buyBtn').forEach(btn => btn.addEventListener('click', async (e)=>{
      const sku = btn.dataset.sku;
      const title = btn.dataset.title;
      const price = parseInt(btn.dataset.price);
      openCheckout({sku,title,price});
    }));

    document.getElementById('contactBtn').addEventListener('click', ()=>{
      window.open('https://wa.me/6285800650661','_blank')
    })

    function openCheckout(item){
      currentTransaction = {item};
      document.getElementById('modalTitle').innerText = 'Checkout — ' + item.title;
      document.getElementById('modalBody').innerHTML = `
        <div style="display:flex;flex-direction:column;gap:8px">
          <div><strong>${item.title}</strong></div>
          <div class="muted">Nominal: Rp${item.price.toLocaleString()}</div>
          <div style="margin-top:8px"><button class="btn" onclick="createQris(${item.price})">Bayar via QRIS (Payku)</button></div>
        </div>
      `;
      document.getElementById('overlay').classList.add('open');
    }

    function closeModal(){
      document.getElementById('overlay').classList.remove('open');
      currentTransaction = null;
    }

    async function createQris(amount){
      if(!currentTransaction) return;
      const payload = { amount, sku: currentTransaction.item.sku, description: currentTransaction.item.title };
      // frontend calls backend endpoint which will call Payku with your secret key and return transaction object
      try{
        const res = await fetch(API_BASE + '/create-transaction', {
          method:'POST',headers: {'Content-Type':'application/json'},body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(!data.success) throw new Error(data.message || 'Gagal membuat transaksi');
        renderQris(data.transaction);
        // start polling
        pollStatus(data.transaction.transaction_id);
      }catch(err){
        document.getElementById('modalBody').innerHTML = `<div class="muted">Error: ${err.message}</div>`;
      }
    }

    function renderQris(tx){
      currentTransaction.tx = tx;
      document.getElementById('modalBody').innerHTML = `
        <div style="display:flex;flex-direction:column;gap:10px">
          <div class="muted small">ID: ${tx.transaction_id}</div>
          <img src="${tx.qris_url}" class="qr-img" alt="QRIS" />
          <div>Nominal: Rp${tx.amount.toLocaleString()}</div>
          <div class="muted small">QRIS expires in 5 menit. Bot akan cek otomatis.</div>
        </div>
      `;
    }

    let pollInterval = null;
    async function pollStatus(transactionId){
      // polling via backend endpoint which checks Payku transaction status
      let checks = 0;
      const max = 60;
      pollInterval = setInterval(async ()=>{
        try{
          const res = await fetch(API_BASE + '/transaction/' + transactionId);
          const data = await res.json();
          if(data.success && data.status){
            if(data.status === 'paid'){
              clearInterval(pollInterval);
              document.getElementById('modalBody').innerHTML = `<div style="font-weight:700;color:lime">Pembayaran diterima!<br/>Metode: ${data.payment_method || 'QRIS'}</div>`;
              // automático kirim produk (backend harus handle auto-delivery webhook)
            } else if(data.status === 'expired' || data.status === 'cancelled'){
              clearInterval(pollInterval);
              document.getElementById('modalBody').innerHTML = `<div class="muted">Status: ${data.status}</div>`;
            } else {
              // pending
              checks++;
              if(checks>=max){
                clearInterval(pollInterval);
                document.getElementById('modalBody').innerHTML = `<div class="muted">QRIS expired (waktu habis).</div>`;
              }
            }
          } else {
            checks++;
          }
        }catch(e){
          console.error('Poll error',e);
        }
      }, 5000);
    }

    async function cancelCurrent(){
      if(!currentTransaction?.tx) return closeModal();
      try{
        const res = await fetch(API_BASE + '/transaction/' + currentTransaction.tx.transaction_id + '/cancel', {method:'POST'});
        const data = await res.json();
        if(data.success){
          clearInterval(pollInterval);
          document.getElementById('modalBody').innerHTML = `<div class="muted">Transaksi dibatalkan.</div>`;
        }else throw new Error(data.message||'Gagal');
      }catch(e){
        document.getElementById('modalBody').innerHTML = `<div class="muted">Error: ${e.message}</div>`;
      }
    }

  </script>  <!--
    NOTE FOR DEVELOPER / BACKEND
    ----------------------------------
    The front-end above expects these backend endpoints under /api:
      POST /api/create-transaction  -> body: { amount, sku, description }
         returns: { success:true, transaction: { transaction_id, amount, qris_url, fee, total_amount } }

      GET  /api/transaction/:transactionId -> returns: { success:true, status: 'pending'|'paid'|'expired'|'cancelled', amount, payment_method }

      POST /api/transaction/:transactionId/cancel -> returns { success:true, message }

    Below is a minimal Node.js (Express) sample that adapts your Payku logic (place in server.js).
  --></body>
</html>
